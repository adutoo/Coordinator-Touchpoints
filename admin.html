<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Coordinator Touchpoints — Admin</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <div class="container">
    <div id="navHolder"></div>

    <div class="grid">

      <!-- Create coordinator account -->
      <div class="card span6">
        <h2>Create Coordinator Account</h2>
        <p class="muted">Creates login for coordinators/admin. (Admin-only)</p>

        <form id="createUserForm" class="form">
          <div class="field span6">
            <label>Email</label>
            <input id="newEmail" type="email" placeholder="name@school.com" required />
          </div>

          <div class="field span6">
            <label>Display Name</label>
            <input id="newName" type="text" placeholder="Coordinator Name" required />
          </div>

          <div class="field span6">
            <label>Password</label>
            <input id="newPassword" type="text" placeholder="Set a password" required />
          </div>

          <div class="field span6">
            <label>Role</label>
            <select id="newRole" data-placeholder="Select role...">
              <option value="coordinator" selected>Coordinator</option>
              <option value="admin">Admin</option>
            </select>
          </div>

          <div class="field span12">
            <button class="btn primary" type="submit">Create Account</button>
          </div>
        </form>

        <div id="userMsg" class="notice" style="display:none;"></div>
      </div>

      <!-- Manage Accounts (Delete users) -->
      <div class="card span6">
        <h2>Manage Accounts</h2>
        <p class="muted">Search and delete coordinators/admin. (Admin-only)</p>

        <div class="form">
          <div class="field span8">
            <label>Search (name/email)</label>
            <input id="userSearch" type="text" placeholder="Type to search…" />
          </div>
          <div class="field span4">
            <label>&nbsp;</label>
            <button id="userRefreshBtn" class="btn" type="button">Refresh</button>
          </div>
        </div>

        <div class="tablewrap maxh">
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="userRows"></tbody>
          </table>
        </div>

        <div id="userMgmtMsg" class="notice" style="display:none;"></div>
      </div>

      <!-- ✅ Manage Sessions -->
      <div class="card span6">
        <h2>Manage Sessions</h2>
        <p class="muted">
          Sessions control default report date ranges.
          Rule: <b>From = 01-04-YYYY</b> and <b>To = 01-04-(YYYY+1)</b>.
        </p>

        <div class="form">
          <div class="field span12">
            <label>Sessions (one per line, like 2025-26)</label>
            <textarea id="sessList" rows="7" placeholder="2024-25&#10;2025-26&#10;2026-27"></textarea>
          </div>

          <div class="field span6">
            <label>Default Session (Global)</label>
            <select id="sessDefault" data-placeholder="Select default..."></select>
            <div id="sessRangePreview" class="muted" style="margin-top:8px;"></div>
          </div>

          <div class="field span6">
            <label>&nbsp;</label>
            <div class="row" style="gap:10px;flex-wrap:wrap;">
              <button id="sessSave" class="btn primary" type="button">Save Sessions</button>
              <button id="sessUseDefault" class="btn" type="button">Use Default Now</button>
            </div>
          </div>
        </div>

        <div id="sessMsg" class="notice" style="display:none;"></div>
      </div>

      <!-- Upload students -->
      <div class="card span6">
        <h2>Upload Students (Excel)</h2>
        <p class="muted">
          Required headers:
          <b>SR No</b>, <b>Student Name</b>, <b>Class</b>, <b>Section</b>, <b>Concat</b> (Child Name)
        </p>

        <div class="file-picker" style="margin-top:10px;">
          <input id="excelFile" class="file-input-hidden" type="file" accept=".xlsx,.xls" />
          <button id="chooseFileBtn" class="btn" type="button">Choose Excel File</button>
          <div id="fileNameChip" class="file-name-chip">No file chosen</div>

          <button id="parseBtn" class="btn" type="button">Parse</button>
          <button id="uploadBtn" class="btn primary" type="button" disabled>Upload to DB</button>
        </div>

        <div class="muted" id="uploadMeta" style="margin-top:10px;"></div>

        <div class="tablewrap maxh" style="margin-top:10px;">
          <table>
            <thead>
              <tr>
                <th>Child Name</th>
                <th>Student Name</th>
                <th>Class</th>
                <th>Section</th>
                <th>SR No</th>
              </tr>
            </thead>
            <tbody id="previewRows"></tbody>
          </table>
        </div>

        <div id="stuMsg" class="notice" style="display:none;"></div>
      </div>

      <!-- Remove Students (Search + Delete) -->
      <div class="card span6">
        <h2>Remove Students</h2>
        <p class="muted">Search by Child Name / Student Name / SR No and delete.</p>

        <div class="form">
          <div class="field span8">
            <label>Search</label>
            <input id="stuSearch" type="text" placeholder="e.g., Mahatva / 1012 / 9C" />
          </div>
          <div class="field span4">
            <label>&nbsp;</label>
            <button id="stuRefreshBtn" class="btn" type="button">Search</button>
          </div>
        </div>

        <div class="muted" id="stuSearchMeta" style="margin-top:8px;"></div>

        <div class="tablewrap maxh" style="margin-top:10px;">
          <table>
            <thead>
              <tr>
                <th>Child Name</th>
                <th>Name</th>
                <th>Class</th>
                <th>Section</th>
                <th>SR</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="stuRows"></tbody>
          </table>
        </div>

        <div id="stuDelMsg" class="notice" style="display:none;"></div>
      </div>

      <!-- Manage Mediums -->
      <div class="card span6">
        <h2>Manage Mediums</h2>
        <p class="muted">Time (min) is auto-filled in Entry. Default is 1 min. You can edit anytime.</p>

        <form id="addMediumForm" class="form">
          <div class="field span6">
            <label>Medium Label</label>
            <input id="medLabel" type="text" placeholder="e.g., Parent 1:1 Meet" required />
          </div>

          <div class="field span3">
            <label>Time (min)</label>
            <input id="medTimeMin" type="number" min="1" value="1" />
          </div>

          <div class="field span3">
            <label>&nbsp;</label>
            <button class="btn primary" type="submit">Add Medium</button>
          </div>
        </form>

        <div class="tablewrap maxh">
          <table>
            <thead>
              <tr>
                <th>Label</th>
                <th>Time (min)</th>
                <th>Active</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="mediumRows"></tbody>
          </table>
        </div>

        <div id="medMsg" class="notice" style="display:none;"></div>
      </div>

      <!-- Manage Objectives -->
      <div class="card span6">
        <h2>Manage Objectives</h2>
        <p class="muted">Soft-remove by turning Active OFF.</p>

        <form id="addObjForm" class="form">
          <div class="field span9">
            <label>Objective Label</label>
            <input id="objLabel" type="text" placeholder="e.g., Attendance, Counselling..." required />
          </div>
          <div class="field span3">
            <label>&nbsp;</label>
            <button class="btn primary" type="submit">Add Objective</button>
          </div>
        </form>

        <div class="tablewrap maxh">
          <table>
            <thead>
              <tr>
                <th>Label</th>
                <th>Active</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="objectiveRows"></tbody>
          </table>
        </div>

        <div id="objMsg" class="notice" style="display:none;"></div>
      </div>

      <!-- Manage Ticket Raised options -->
      <div class="card span6">
        <h2>Manage Ticket Raised Options</h2>
        <p class="muted">Configure the Ticket raised? dropdown used in Entry.</p>

        <form id="addTicketForm" class="form">
          <div class="field span9">
            <label>Option Label</label>
            <input id="ticketLabel" type="text" placeholder="e.g., Yes / No / Pending" required />
          </div>
          <div class="field span3">
            <label>&nbsp;</label>
            <button class="btn primary" type="submit">Add Option</button>
          </div>
        </form>

        <div class="tablewrap maxh">
          <table>
            <thead>
              <tr>
                <th>Label</th>
                <th>Active</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="ticketRows"></tbody>
          </table>
        </div>

        <div id="ticketMsg" class="notice" style="display:none;"></div>
      </div>

      <!-- ✅ Manage Ticket Statuses -->
      <div class="card span6">
        <h2>Manage Ticket Statuses</h2>
        <p class="muted">Controls Ticket Status dropdown used in Ticket Reports.</p>

        <form id="addStatusForm" class="form">
          <div class="field span8">
            <label>Status Label</label>
            <input id="statusLabel" type="text" placeholder="e.g., Open / In Progress / Closed" required />
          </div>
          <div class="field span4">
            <label>Sort Order</label>
            <input id="statusSort" type="number" value="100" />
          </div>
          <div class="field span12">
            <button class="btn primary" type="submit">Add Status</button>
          </div>
        </form>

        <div class="tablewrap maxh">
          <table>
            <thead>
              <tr>
                <th>Label</th>
                <th>Sort</th>
                <th>Active</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="statusRows"></tbody>
          </table>
        </div>

        <div id="statusMsg" class="notice" style="display:none;"></div>
      </div>

      <!-- Ticket Validation: Issue Raised By -->
      <div class="card span6">
        <h2>Ticket Validation — Issue Raised By</h2>
        <p class="muted">Controls Ticket Entry dropdown: Issue Raised By.</p>

        <form id="addIrbyForm" class="form">
          <div class="field span8">
            <label>Label</label>
            <input id="irbyLabel" type="text" placeholder="e.g., Parent / Teacher / Student" required />
          </div>
          <div class="field span4">
            <label>Sort Order</label>
            <input id="irbySort" type="number" value="100" />
          </div>
          <div class="field span12">
            <button class="btn primary" type="submit">Add</button>
          </div>
        </form>

        <div class="tablewrap maxh">
          <table>
            <thead>
              <tr>
                <th>Label</th>
                <th>Sort</th>
                <th>Active</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="irbyRows"></tbody>
          </table>
        </div>

        <div id="irbyMsg" class="notice" style="display:none;"></div>
      </div>

      <!-- Ticket Validation: Departments -->
      <div class="card span6">
        <h2>Ticket Validation — Departments</h2>
        <p class="muted">Controls Department dropdown + whether Subject is required.</p>

        <form id="addDeptForm" class="form">
          <div class="field span6">
            <label>Department Label</label>
            <input id="deptLabel" type="text" placeholder="e.g., Core Academics" required />
          </div>
          <div class="field span3">
            <label>Requires Subject?</label>
            <select id="deptReqSub" data-placeholder="Select...">
              <option value="false" selected>No</option>
              <option value="true">Yes</option>
            </select>
          </div>
          <div class="field span3">
            <label>Sort Order</label>
            <input id="deptSort" type="number" value="100" />
          </div>
          <div class="field span12">
            <button class="btn primary" type="submit">Add</button>
          </div>
        </form>

        <div class="tablewrap maxh">
          <table>
            <thead>
              <tr>
                <th>Department</th>
                <th>Req. Subject</th>
                <th>Sort</th>
                <th>Active</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="deptRows"></tbody>
          </table>
        </div>

        <div id="deptMsg" class="notice" style="display:none;"></div>
      </div>

      <!-- Ticket Validation: Subjects -->
      <div class="card span6">
        <h2>Ticket Validation — Subjects</h2>
        <p class="muted">Controls Subject dropdown.</p>

        <form id="addSubjForm" class="form">
          <div class="field span8">
            <label>Label</label>
            <input id="subjLabel" type="text" placeholder="e.g., Maths / Science" required />
          </div>
          <div class="field span4">
            <label>Sort Order</label>
            <input id="subjSort" type="number" value="100" />
          </div>
          <div class="field span12">
            <button class="btn primary" type="submit">Add</button>
          </div>
        </form>

        <div class="tablewrap maxh">
          <table>
            <thead>
              <tr>
                <th>Label</th>
                <th>Sort</th>
                <th>Active</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="subjRows"></tbody>
          </table>
        </div>

        <div id="subjMsg" class="notice" style="display:none;"></div>
      </div>

      <!-- Ticket Validation: Categories -->
      <div class="card span6">
        <h2>Ticket Validation — Categories</h2>
        <p class="muted">Category list depends on Issue Raised By + Department.</p>

        <form id="addCatForm" class="form">
          <div class="field span4">
            <label>Issue Raised By</label>
            <select id="catIrby" data-placeholder="Select issue raised by..."></select>
          </div>
          <div class="field span4">
            <label>Department</label>
            <select id="catDept" data-placeholder="Select department..."></select>
          </div>
          <div class="field span4">
            <label>Sort Order</label>
            <input id="catSort" type="number" value="100" />
          </div>

          <div class="field span12">
            <label>Category Label</label>
            <input id="catLabel" type="text" placeholder="e.g., Homework / Discipline / Fee Issue" required />
          </div>

          <div class="field span12">
            <button class="btn primary" type="submit">Add Category</button>
          </div>
        </form>

        <div class="tablewrap maxh">
          <table>
            <thead>
              <tr>
                <th>Issue Raised By</th>
                <th>Department</th>
                <th>Category</th>
                <th>Sort</th>
                <th>Active</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="catRows"></tbody>
          </table>
        </div>

        <div id="catMsg" class="notice" style="display:none;"></div>
      </div>

      <!-- Ticket Validation: POC Map -->
      <div class="card span6">
        <h2>Ticket Validation — POC Map</h2>
        <p class="muted">Maps Reporter Email → Point Of Contact Email.</p>

        <form id="addPocForm" class="form">
          <div class="field span6">
            <label>Reporter Email</label>
            <input id="pocReporter" type="email" placeholder="reporter@school.com" required />
          </div>
          <div class="field span6">
            <label>POC Email</label>
            <input id="pocEmail" type="email" placeholder="poc@school.com" required />
          </div>
          <div class="field span12">
            <button class="btn primary" type="submit">Save Mapping</button>
          </div>
        </form>

        <div class="tablewrap maxh">
          <table>
            <thead>
              <tr>
                <th>Reporter</th>
                <th>POC</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="pocRows"></tbody>
          </table>
        </div>

        <div id="pocMsg" class="notice" style="display:none;"></div>
      </div>

      <!-- Ticket Validation: POR Map -->
      <div class="card span6">
        <h2>Ticket Validation — POR Map</h2>
        <p class="muted">Maps Department → Point Of Resolution Email.</p>

        <form id="addPorForm" class="form">
          <div class="field span6">
            <label>Department</label>
            <select id="porDept" data-placeholder="Select department..."></select>
          </div>
          <div class="field span6">
            <label>POR Email</label>
            <input id="porEmail" type="email" placeholder="por@school.com" required />
          </div>
          <div class="field span12">
            <button class="btn primary" type="submit">Save Mapping</button>
          </div>
        </form>

        <div class="tablewrap maxh">
          <table>
            <thead>
              <tr>
                <th>Department</th>
                <th>POR</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="porRows"></tbody>
          </table>
        </div>

        <div id="porMsg" class="notice" style="display:none;"></div>
      </div>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>
  <script type="module" src="js/admin.js"></script>
</body>
</html>
